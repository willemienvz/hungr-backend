<div class="step3-container openTop">
  <ng-content select="[header]"></ng-content>

  <div class="block rowSpecial openTop">
    <form [formGroup]="specialForm">
      <!-- Percentage Discount -->
      <div *ngIf="selectedSpecialType === 1">
        <p>Select Items and Percentage</p>
        <div class="row">
          <div class="inputBox">
            <input
              type="text"
              placeholder="Search and select menu items..."
              [formControl]="menuItemAutocompleteControl"
              [matAutocomplete]="auto"
            />
            <mat-autocomplete 
              #auto="matAutocomplete" 
              [displayWith]="displayFn"
              (optionSelected)="onMenuItemSelected($event)"
            >
              <mat-option 
                *ngFor="let menuItem of filteredMenuItems | async" 
                [value]="menuItem"
              >
                <span>{{ menuItem.name }}</span>
              </mat-option>
              
              <!-- Show no results message when no items match -->
              <mat-option 
                *ngIf="(filteredMenuItems | async)?.length === 0" 
                class="no-results-option" 
                disabled
              >
                <span class="no-results-text">No menu items found</span>
              </mat-option>
            </mat-autocomplete>
          </div>
          <input
            type="number"
            formControlName="percentage"
            placeholder="Enter percentage discount"
            (keydown.enter)="onAddItem()"
          />
        </div>
      </div>

      <!-- Price Discount (Add Mode) -->
      <div *ngIf="selectedSpecialType === 2 && !editMode">
        <p>Select Items and Prices</p>
        <div class="row">
          <div class="inputBox">
            <input
              type="text"
              placeholder="Search and select menu items..."
              [formControl]="menuItemAutocompleteControl"
              [matAutocomplete]="auto"
            />
            <mat-autocomplete 
              #auto="matAutocomplete" 
              [displayWith]="displayFn"
              (optionSelected)="onMenuItemSelected($event)"
            >
              <mat-option 
                *ngFor="let menuItem of filteredMenuItems | async" 
                [value]="menuItem"
              >
                <span>{{ menuItem.name }}</span>
              </mat-option>
              
              <!-- Show no results message when no items match -->
              <mat-option 
                *ngIf="(filteredMenuItems | async)?.length === 0" 
                class="no-results-option" 
                disabled
              >
                <span class="no-results-text">No menu items found</span>
              </mat-option>
            </mat-autocomplete>
          </div>
          <app-price-input
            formControlName="amount"
            placeholder="R 0.00"
            label=""
            [required]="true"
            (keydown.enter)="onAddItem()">
          </app-price-input>
        </div>
      </div>

      <!-- Price Discount (Edit Mode) -->
      <div *ngIf="selectedSpecialType === 2 && editMode">
        <p>Select Items and Prices</p>
        <div class="row">
          <mat-select formControlName="typeSpecialDetails">
            <mat-option
              *ngFor="let item of selectedMenu?.items"
              [value]="item.name"
            >
              {{ item.name }}
            </mat-option>
          </mat-select>
          <app-price-input
            formControlName="amount"
            placeholder="R 0.00"
            label=""
            [required]="true"
            (keydown.enter)="onAddItem()">
          </app-price-input>
        </div>
      </div>

      <!-- Category Special -->
      <div *ngIf="selectedSpecialType === 4">
        <p>Select Category</p>
        <div class="row">
          <mat-select formControlName="featureSpecialUnder">
            <mat-option
              *ngFor="let category of selectedMenu?.categories"
              [value]="category.id"
            >
              {{ category.name }}
            </mat-option>
          </mat-select>
          <app-price-input
            formControlName="amount"
            placeholder="R 0.00"
            label=""
            [required]="true"
            (keydown.enter)="onAddItem()">
          </app-price-input>
        </div>
      </div>

      <!-- Combo Special -->
      <div *ngIf="selectedSpecialType === 3">
        <h6>Combo Details</h6>
        <div class="row">
          <mat-select formControlName="typeSpecialDetails" multiple>
            <mat-option
              *ngFor="let item of selectedMenu?.items"
              [value]="item.name"
            >
              {{ item.name }}
            </mat-option>
          </mat-select>
          <input
            type="number"
            formControlName="percentage"
            placeholder="Enter percentage discount"
            (keydown.enter)="onAddItem()"
          />
        </div>
      </div>
      
      <p style="text-align: right; width: 100%">Press enter to add an item</p>
      
      <!-- Display List of Added Items -->
      <div *ngIf="addedItems.length > 0" class="item-list">
        <h6>Items</h6>
        <div class="list" *ngFor="let item of addedItems; let i = index">
          <div>
            <a class="btnRemove" (click)="onRemoveItem(i)">X</a>
            <p>{{ item.name }}</p>
          </div>
          <p>{{ item.amount }}</p>
        </div>
      </div>
    </form>
  </div>
</div> 