<div class="container">
  <!-- Progress Bar -->

  <!-- Step 1: Special Basics -->
  <div *ngIf="currentStep === 1">
    <app-step1-special-basics
      [specialForm]="specialForm"
      [menus]="menus"
      [specialTypes]="specialTypes"
      [selectedMenu]="selectedMenu"
      [isSaving]="isSaving"
      (menuChange)="onMenuChange()"
      (specialTypeChange)="onSpecialTypeChange()"
    >
      <ng-container header>
        <div class="headerBlock">
          <app-progress-bar 
            [showBackButton]="true"
            [progress]="currentStep" 
            [tooltipInfo]="'This is a tooltip'"
            [backRoute]="'/specials'"
            [backText]="'Back'"
            (stepClick)="navigateToStep($event)"
            (backButtonClick)="onBackButtonClick()">
          </app-progress-bar>
          <app-step-header
            [stepNumber]="1"
            [stepTitle]="'Special Basics'"
            [showDescription]="false">
          </app-step-header>
        </div>
      </ng-container>
    </app-step1-special-basics>
    <app-step-navigation
      [showNext]="showNextButton"
      [nextDisabled]="isStep1Invalid()"
      [cancelRoute]="'/specials'"
      [isSaving]="isSaving"
      (next)="nextStep()"
    ></app-step-navigation>
  </div>

  <!-- Step 2: Days and Times -->
  <div *ngIf="currentStep === 2">
    <app-step2-days-times
      [specialForm]="specialForm"
      [weekdays]="weekdays"
      [selectedDays]="selectedDays"
      [isSaving]="isSaving"
      (toggleSelection)="toggleSelection($event)"
      (previous)="previousStep()"
      (draft)="onDraftSave()"
      (next)="nextStep()"
    >
      <ng-container header>
        <div class="headerBlock">
          <app-progress-bar 
            [progress]="currentStep" 
            [backRoute]="'/specials'"
            [backText]="'Back'"
            (stepClick)="navigateToStep($event)"
            (backButtonClick)="onBackButtonClick()">
          </app-progress-bar>
          <app-special-summary
            [specialTitle]="specialForm.get('specialTitle')?.value"
            [specialType]="specialForm.get('typeSpecial')?.value"
            [dateFrom]="specialForm.get('dateFrom')?.value"
            [dateTo]="specialForm.get('dateTo')?.value"
            [timeFrom]="specialForm.get('timeFrom')?.value"
            [timeTo]="specialForm.get('timeTo')?.value"
            [selectedDays]="selectedDays"
            [currentStep]="currentStep"
            [specialTypes]="specialTypes">
          </app-special-summary>
          <app-step-header
            [stepNumber]="2"
            [stepTitle]="'Days and Times'"
            [showDescription]="false">
          </app-step-header>
        </div>
      </ng-container>
    </app-step2-days-times>
    <app-step-navigation
      [showPrevious]="true"
      [showDraft]="true"
      [showNext]="showNextButton"
      [isSaving]="isSaving"
      [nextDisabled]="isStep2Invalid()"
      (previous)="previousStep()"
      (draft)="onDraftSave()"
      (next)="nextStep()"
    ></app-step-navigation>
  </div>

  <!-- Step 3: Special Details -->
  <div *ngIf="currentStep === 3">
    <app-step3-special-details
      [specialForm]="specialForm"
      [selectedMenu]="selectedMenu"
      [selectedSpecialType]="selectedSpecialType"
      [addedItems]="addedItems"
      [menuItemAutocompleteControl]="menuItemAutocompleteControl"
      [filteredMenuItems]="filteredMenuItems"
      [isSaving]="isSaving"
      (menuItemSelected)="onMenuItemSelected($event)"
      (addItem)="addItem()"
      (removeItem)="removeItem($event)"
    >
      <ng-container header>
        <div class="headerBlock">
          <app-progress-bar 
            [progress]="currentStep" 
            [backRoute]="'/specials'"
            [backText]="'Back'"
            (stepClick)="navigateToStep($event)"
            (backButtonClick)="onBackButtonClick()">
          </app-progress-bar>
          <app-special-summary
            [specialTitle]="specialForm.get('specialTitle')?.value"
            [specialType]="specialForm.get('typeSpecial')?.value"
            [dateFrom]="specialForm.get('dateFrom')?.value"
            [dateTo]="specialForm.get('dateTo')?.value"
            [timeFrom]="specialForm.get('timeFrom')?.value"
            [timeTo]="specialForm.get('timeTo')?.value"
            [selectedDays]="selectedDays"
            [currentStep]="currentStep"
            [specialTypes]="specialTypes">
          </app-special-summary>
          <app-step-header
            [stepNumber]="3"
            [stepTitle]="'Special Details'"
            [showDescription]="false">
          </app-step-header>
        </div>
      </ng-container>
    </app-step3-special-details>
    <app-step-navigation
      [showPrevious]="true"
      [showDraft]="true"
      [showNext]="showNextButton"
      [isSaving]="isSaving"
      (previous)="previousStep()"
      (draft)="onDraftSave()"
      (next)="nextStep()"
    ></app-step-navigation>
  </div>

  <!-- Step 4: Add Media -->
  <div *ngIf="currentStep === 4">
    <app-step4-add-media
      [uploadedImageUrl]="uploadedImageUrl"
      [mediaId]="mediaId"
      [isSaving]="isSaving"
      (openImageUploadModal)="openImageUploadModal()"
      (deleteMedia)="onDeleteMedia()"
    >
      <ng-container header>
        <div class="headerBlock">
          <app-progress-bar 
            [progress]="currentStep" 
            [backRoute]="'/specials'"
            [backText]="'Back'"
            (stepClick)="navigateToStep($event)"
            (backButtonClick)="onBackButtonClick()">
          </app-progress-bar>
          <app-special-summary
            [specialTitle]="specialForm.get('specialTitle')?.value"
            [specialType]="specialForm.get('typeSpecial')?.value"
            [dateFrom]="specialForm.get('dateFrom')?.value"
            [dateTo]="specialForm.get('dateTo')?.value"
            [timeFrom]="specialForm.get('timeFrom')?.value"
            [timeTo]="specialForm.get('timeTo')?.value"
            [selectedDays]="selectedDays"
            [currentStep]="currentStep"
            [specialTypes]="specialTypes">
          </app-special-summary>
          <app-step-header
            [stepNumber]="4"
            [stepTitle]="'Add Media'"
            [description]="'Uploading media helps to raise awareness of the special.'"
            [showDescription]="true">
          </app-step-header>
        </div>
      </ng-container>
    </app-step4-add-media>
    <app-step-navigation
      [showPrevious]="true"
      [showDraft]="true"
      [showNext]="showNextButton"
      [isSaving]="isSaving"
      (previous)="previousStep()"
      (draft)="onDraftSave()"
      (next)="nextStep()"
    ></app-step-navigation>
  </div>

  <!-- Step 5: Overview -->
  <div *ngIf="currentStep === 5">
    <app-step5-overview
      [specialForm]="specialForm"
      [selectedSpecialType]="selectedSpecialType"
      [selectedDays]="selectedDays"
      [addedItems]="addedItems"
      [isSaving]="isSaving"
      [editMode]="false"
    >
      <ng-container header>
        <div class="headerBlock">
          <app-progress-bar 
            [progress]="currentStep" 
            [backRoute]="'/specials'"
            [backText]="'Back'"
            (stepClick)="navigateToStep($event)"
            (backButtonClick)="onBackButtonClick()">
          </app-progress-bar>
          <app-step-header
            [stepNumber]="5"
            [stepTitle]="'Overview'"
            [showDescription]="false">
          </app-step-header>
        </div>
      </ng-container>
    </app-step5-overview>
    <app-step-navigation
      [showPrevious]="true"
      [showDraft]="true"
      [showSubmit]="true"
      [showNext]="false"
      [submitText]="'Publish Special'"
      [isSaving]="isSaving"
      (previous)="previousStep()"
      (draft)="onDraftSave()"
      (submit)="onSubmit()"
    ></app-step-navigation>
  </div>
</div>

<!-- Image upload modal replaced with standardized ImageUploadModalComponent -->

<div class="popup" *ngIf="showSuccessPopup">
  <div class="popup-content">
    <i class="material-icons popup-close" routerLink="/specials">close</i>
    <div class="row">
      <div class="col">
        <h1>Your new special is now Live</h1>
        <p>
          Your new Special has successfully been saved and published. It can be
          viewed by anyone viewing your menu.
        </p>
        <button class="hungr-btn hungr-btn-secondary" (click)="onBackButtonClick()">Done</button>
      </div>
    </div>
  </div>
</div>

<app-loading [isLoading]="isSaving"></app-loading>
