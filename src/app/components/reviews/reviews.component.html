<div class="reviews-container">
  <app-content-block [showHeader]="false">

    <div class="reviews-controls">
      <div class="search-container">
        <div class="search-input">
          <i class="material-icons">search</i>
          <input 
            type="text" 
            [value]="searchControl.value"
            (input)="onSearchInput($event)"
            placeholder="Search by customer name or message..."
            class="search-field">
        </div>
      </div>
      <div class="filter-dropdown">
        <mat-select 
          [placeholder]="'Filter by status'" 
          [value]="currentFilter"
          (selectionChange)="onFilterChange($event.value)">
          <mat-option 
            *ngFor="let option of reviewFilterOptions" 
            [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
        <mat-icon class="filter-icon">filter_list</mat-icon>
      </div>
      <div class="filter-dropdown">
        <mat-select 
          [placeholder]="'Filter by menu item'"
          [value]="'all'"
          (selectionChange)="onMenuItemFilterChange($event.value)">
          <mat-option [value]="'all'">All menu items</mat-option>
          <mat-option *ngFor="let menuItem of menuItems" [value]="menuItem.itemId">
            {{ menuItem.name }}
          </mat-option>
        </mat-select>
        <mat-icon class="filter-icon">restaurant_menu</mat-icon>
      </div>
    </div>

    <div class="reviews-content">
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Loading reviews...</p>
    </div>

      <div *ngIf="!loading" class="reviews-list">
      <ng-container *ngIf="(paginatedReviews$ | async) as reviews; else noReviews">
        <div *ngFor="let review of reviews" class="review-item">
          <div class="review-header">
            <div class="review-info">
              <h3>{{ menuItemNameMap[review.menuItemId] || review.menuItemId }}</h3>
              <div class="review-rating">
                <span class="stars">
                  <i *ngFor="let star of [1,2,3,4,5]" 
                     class="material-icons"
                     [class.filled]="star <= review.rating">
                    {{ star <= review.rating ? 'star' : 'star_border' }}
                  </i>
                </span>
                <span class="rating-text">{{ review.rating }}/5</span>
              </div>
            </div>
            <div class="review-status">
              <span class="status-badge" [class]="'status-' + review.status">
                {{ review.status.charAt(0).toUpperCase() + review.status.slice(1) }}
              </span>
            </div>
          </div>
          
          <div class="review-message">
            <p>{{ review.message }}</p>
          </div>
          
          <div class="review-meta">
            <span class="review-date">
              <i class="material-icons">schedule</i>
              {{ review.createdAt.toLocaleString() }}
            </span>
            <span *ngIf="review.restaurantId" class="review-scope">
              <i class="material-icons">store</i>
              {{ getRestaurantName(review.restaurantId) }}
            </span>
            <span class="review-menu-item" *ngIf="review.menuItemId">
              <i class="material-icons">restaurant_menu</i>
              {{ menuItemNameMap[review.menuItemId] || review.menuItemId }}
            </span>
            
            <!-- Moderated by removed per request -->
          </div>

          <!-- Moderation notes hidden for now -->

          <div class="review-actions">
            <ng-container *ngIf="review.status === 'pending'; else approvedActions">
            <button class="btnPrimary" (click)="approveReview(review)">
              <i class="material-icons">check</i>
              Approve
            </button>
            <button class="btnOutline" (click)="rejectReview(review)">
              <i class="material-icons">close</i>
              Reject
            </button>
            </ng-container>
            <ng-template #approvedActions>
            <button class="btnOutline" (click)="unapproveReview(review)">
              <i class="material-icons">undo</i>
              Unapprove
            </button>
            </ng-template>

            <button class="btnSecondary" (click)="deleteReview(review)">
              <i class="material-icons">delete</i>
              Delete
            </button>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="(totalPages$ | async) as totalPages">
        <div class="review-pagination" *ngIf="totalPages > 1">
        <ng-container *ngIf="(pageIndex$ | async) as pageIndex">
          <button class="pagination-btn" (click)="goToPage(1, totalPages)">
            <i class="material-icons">first_page</i>
          </button>
          <button class="pagination-btn" (click)="goToPage(pageIndex - 1, totalPages)">
            <i class="material-icons">chevron_left</i>
          </button>
          <span class="page-indicator">Page {{ pageIndex }} of {{ totalPages }}</span>
          <button class="pagination-btn" (click)="goToPage(pageIndex + 1, totalPages)">
            <i class="material-icons">chevron_right</i>
          </button>
          <button class="pagination-btn" (click)="goToPage(totalPages, totalPages)">
            <i class="material-icons">last_page</i>
          </button>
        </ng-container>
        </div>
      </ng-container>

      <ng-template #noReviews>
        <div class="no-reviews">
          <i class="material-icons">rate_review</i>
          <h3>No reviews found</h3>
          <p>There are no reviews matching the current filter.</p>
        </div>
      </ng-template>
    </div>
  </div>
  </app-content-block>
</div> 