<app-page-layout
  title="Media Library"
  subtitle="Manage your uploaded images and media files"
  [actions]="pageActions"
  [loading]="loading">

  <!-- Media Stats -->
  <div class="stats-grid" *ngIf="filteredMedia.length > 0">
    <app-stats-card
      title="Total Files"
      [value]="filteredMedia.length"
      icon="image">
    </app-stats-card>

    <app-stats-card
      title="Storage Used"
      [value]="getTotalStorageSize()"
      icon="storage">
    </app-stats-card>

    <app-stats-card
      title="Categories"
      [value]="getUniqueCategoriesCount()"
      icon="category">
    </app-stats-card>
  </div>

  <!-- Filters and Controls Section -->
  <app-content-block [showHeader]="false">
    <div class="media-filters">
      <!-- Search Bar -->
      <div class="filter-group">
        <app-form-input
          label="Search"
          placeholder="Search by name or description"
          [formControl]="searchControl"
          prefixIcon="search">
        </app-form-input>
      </div>

      <!-- Filter Controls -->
      <div class="filter-group">
        <app-form-select
          label="Category"
          placeholder="All Categories"
          [options]="categoryOptions"
          [(ngModel)]="selectedCategory"
          (selectionChange)="onCategoryChange($event)">
        </app-form-select>
      </div>

      <div class="filter-group">
        <app-form-select
          label="Sort By"
          placeholder="Sort by"
          [options]="sortOptions"
          [(ngModel)]="sortBy"
          (selectionChange)="onSortChange($event)">
        </app-form-select>
      </div>

      <!-- Sort Order and Clear Filters -->
      <div class="filter-actions">
       <!-- <app-button
          [icon]="sortOrder === 'asc' ? 'arrow_upward' : 'arrow_downward'"
          (buttonClick)="toggleSortOrder()"
          type="tertiary"
          size="small">
          {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}
        </app-button>-->

        <app-button
          *ngIf="hasActiveFilters"
          icon="clear"
          (buttonClick)="clearFilters()"
          type="tertiary"
          size="small">
          Clear Filters
        </app-button>
      </div>

      <!-- View Toggle -->
      <div class="view-toggle-group">
        <mat-button-toggle-group [(value)]="viewMode" (change)="changeViewMode($event)" class="view-toggle">
          <mat-button-toggle value="grid" aria-label="Grid view">
            <mat-icon>grid_view</mat-icon>
            <span class="toggle-label">Grid</span>
          </mat-button-toggle>
          <mat-button-toggle value="list" aria-label="List view">
            <mat-icon>view_list</mat-icon>
            <span class="toggle-label">List</span>
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>
  </app-content-block>

  <!-- Error Display -->
  <div *ngIf="error" class="error-message">
    <mat-icon>error</mat-icon>
    <span>{{ error }}</span>
  </div>

  <!-- Media Display Section -->
  <app-content-block>
    <div class="media-content">
      <ng-container *ngIf="!loading; else loadingTemplate">
        <ng-container *ngIf="filteredMedia.length > 0; else emptyTemplate">
          <!-- Grid View -->
          <div *ngIf="viewMode === 'grid'" class="media-grid">
            <div *ngFor="let media of paginatedMedia" class="media-item">
              <div class="media-thumbnail">
                <img [src]="media.thumbnailUrl || media.url" [alt]="media.originalName"
                     (error)="onImageError($event)">
                <div class="media-overlay">
                  <app-action-button
                    type="view"
                    title="View media"
                    (actionClick)="onMediaSelect(media)"
                    customColor="rgba(255, 255, 255, 0.9)">
                  </app-action-button>
                  <app-action-button
                    type="delete"
                    title="Delete media"
                    [loading]="deletingMediaId === media.id"
                    [disabled]="deletingMediaId !== null"
                    (actionClick)="onMediaDelete(media)"
                    customColor="rgba(255, 255, 255, 0.9)">
                  </app-action-button>
                </div>
              </div>
              <div class="media-info">
                <h4 class="media-title" [title]="media.originalName">{{ media.originalName }}</h4>
                <p class="media-meta">
                  <span class="file-size">{{ media.fileSize | fileSize }}</span>
                  <span class="upload-date">{{ media.uploadedAt | date:'short' }}</span>
                </p>
              </div>
            </div>
          </div>

          <!-- List View -->
          <div *ngIf="viewMode === 'list'" class="media-list">
            <div *ngFor="let media of paginatedMedia" class="media-list-item">
              <div class="list-thumbnail">
                <img [src]="media.thumbnailUrl || media.url" [alt]="media.originalName"
                     (error)="onImageError($event)">
              </div>
              <div class="list-info">
                <h4 class="list-title" [title]="media.originalName">{{ media.originalName }}</h4>
                <p class="list-description" *ngIf="media.description">{{ media.description }}</p>
                <div class="list-meta">
                  <span class="file-size">{{ media.fileSize | fileSize }}</span>
                  <span class="upload-date">{{ media.uploadedAt | date:'short' }}</span>
                  <span class="category" *ngIf="media.category">{{ media.category }}</span>
                </div>
              </div>
              <div class="list-actions">
                <app-action-button
                  type="view"
                  title="View media"
                  (actionClick)="onMediaSelect(media)">
                </app-action-button>
                <app-action-button
                  type="delete"
                  title="Delete media"
                  [loading]="deletingMediaId === media.id"
                  [disabled]="deletingMediaId !== null"
                  (actionClick)="onMediaDelete(media)">
                </app-action-button>
              </div>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalItems > itemsPerPage">
      <mat-paginator
        [length]="totalItems"
        [pageSize]="itemsPerPage"
        [pageIndex]="currentPage - 1"
        [pageSizeOptions]="[10, 20, 50, 100]"
        (page)="onPageChange($event)"
        aria-label="Select page">
      </mat-paginator>
    </div>
  </app-content-block>

</app-page-layout>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="loading-container">
    <app-spinner [diameter]="50"></app-spinner>
    <p>Loading media library...</p>
  </div>
</ng-template>

<!-- Empty Template -->
<ng-template #emptyTemplate>
  <div class="empty-container">
    <mat-icon class="empty-icon">image</mat-icon>
    <h3>No media found</h3>
    <p *ngIf="hasActiveFilters">
      No media items match your current filters. 
      <button class="hungr-btn hungr-btn-tertiary" (click)="clearFilters()">Clear filters</button>
    </p>
    <p *ngIf="!hasActiveFilters">Upload your first image to get started</p>
    <button class="hungr-btn hungr-btn-primary" (click)="openUploadModal()">
      <i class="material-icons">add</i>
      Upload Media
    </button>
  </div>
</ng-template> 