<div class="form-select-wrapper" [class]="customClass">
  <!-- Label -->
  <label *ngIf="label" class="form-label" [class.required]="required">
    {{ label }}
  </label>

  <!-- Select container -->
  <mat-form-field [appearance]="appearance" class="select-field">
    <mat-select
      [class]="selectClass"
      [placeholder]="placeholder"
      [value]="value"
      [disabled]="disabled"
      [required]="required"
      [multiple]="multiple"
      (selectionChange)="onSelectionChange($event)"
      (opened)="onFocus()"
      (closed)="onBlur()">

      <!-- Ungrouped options -->
      <ng-container *ngIf="!hasGroups">
        <mat-option
          *ngFor="let option of options"
          [value]="option.value"
          [disabled]="option.disabled">
          {{ option.label }}
        </mat-option>
      </ng-container>

      <!-- Grouped options -->
      <ng-container *ngIf="hasGroups">
        <ng-container *ngFor="let group of groupedOptions | keyvalue">
          <mat-optgroup
            *ngIf="group.key !== ''"
            [label]="group.key">
            <mat-option
              *ngFor="let option of group.value"
              [value]="option.value"
              [disabled]="option.disabled">
              {{ option.label }}
            </mat-option>
          </mat-optgroup>
        </ng-container>

        <!-- Ungrouped options in default group -->
        <ng-container *ngIf="groupedOptions[''] && groupedOptions[''].length > 0">
          <mat-option
            *ngFor="let option of groupedOptions['']"
            [value]="option.value"
            [disabled]="option.disabled">
            {{ option.label }}
          </mat-option>
        </ng-container>
      </ng-container>
    </mat-select>
  </mat-form-field>

  <!-- Error message -->
  <div *ngIf="showError && errorMessage" class="error-message">
    <i class="material-icons">error</i>
    <span>{{ errorMessage }}</span>
  </div>
</div>
