<div class="auth-layout">
    <app-logo containerClass="auth-logo"></app-logo>
    <div class="auth-layout-inner">
        <div class="auth-header-line">
            <a class="backLink no-absolute" routerLink="/sign-in"><span class="material-symbols-outlined">
                    arrow_back
                </span>Back</a>
            <h1>Sign Up</h1>
        </div>
        <form [formGroup]="step1Form">
            <div class="auth-form-grid">
                <div class="auth-form-col">
                    <h6>Your details</h6>
                  
                        <app-form-input
                            label="First name"
                            type="text"
                            placeholder="John"
                            [required]="true"
                            [errorMessage]="getFieldError('firstName')"
                            formControlName="firstName">
                        </app-form-input>

                        <app-form-input
                            label="Surname"
                            type="text"
                            placeholder="Smith"
                            [required]="true"
                            [errorMessage]="getFieldError('lastName')"
                            formControlName="lastName">
                        </app-form-input>

                        <h6 class='mt-md'>Contact Details</h6>
                        <app-form-input
                            label="Email"
                            type="email"
                            placeholder="email@address.co.za"
                            [required]="true"
                            [errorMessage]="step1Form.get('userEmail')?.hasError('emailInUse') ? '' : getFieldError('userEmail')"
                            formControlName="userEmail"
                            (blur)="onEmailBlur()">
                        </app-form-input>
                        <div *ngIf="step1Form.get('userEmail')?.pending" class="email-checking-indicator" style="display: flex; align-items: center; gap: 8px; margin-top: 4px; color: #666; font-size: 12px;">
                            <app-spinner [diameter]="16"></app-spinner>
                            <span>Checking email availability...</span>
                        </div>
                        <div *ngIf="step1Form.get('userEmail')?.hasError('emailInUse') && (step1Form.get('userEmail')?.touched || step1Form.get('userEmail')?.dirty)" class="email-error-message" style="margin-top: 4px; color: #f44336; font-size: 12px;">
                            <span>This email is already registered.</span>
                            <a routerLink="/sign-in" class="log-in-link" style="color: #1976d2; text-decoration: underline; margin-left: 4px; cursor: pointer;">Sign in</a>
                            <span> or try a different email.</span>
                        </div>
                        <div *ngIf="step1Form.get('userEmail')?.hasError('emailCheckFailed') && (step1Form.get('userEmail')?.touched || step1Form.get('userEmail')?.dirty)" class="email-error-message" style="margin-top: 4px; color: #f44336; font-size: 12px;">
                            <span>{{ getFieldError('userEmail') }}</span>
                        </div>
                        <app-form-input
                            label="Cellphone number"
                            type="tel"
                            placeholder="+27 12 234 5678"
                            [required]="true"
                            [errorMessage]="getFieldError('cellphone')"
                            (keydown)="onCellphoneKeyDown($event)"
                            (paste)="onCellphonePaste($event)"
                            formControlName="cellphone">
                        </app-form-input>
              
                </div>
                <div class="auth-form-col">
                    <h6>Login details</h6>
                    <app-form-input
                        label="Password"
                        [type]="showPassword ? 'text' : 'password'"
                        placeholder="Password"
                        [required]="true"
                        [errorMessage]="getFieldError('password')"
                        [suffixIcon]="showPassword ? 'visibility_off' : 'visibility'"
                        (suffixIconClick)="togglePasswordVisibility()"
                        formControlName="password">
                    </app-form-input>

                    <app-form-input
                        label="Confirm Password"
                        [type]="showPasswordConf ? 'text' : 'password'"
                        placeholder="Confirm Password"
                        [required]="true"
                        [errorMessage]="getFieldError('userPwdConfrim')"
                        [suffixIcon]="showPasswordConf ? 'visibility_off' : 'visibility'"
                        (suffixIconClick)="togglePasswordConfirmVisibility()"
                        formControlName="userPwdConfrim">
                    </app-form-input>
                    <div class="auth-info-box mt-md">
                        <p class="auth-info-text">Make sure your password has:</p>
                        <div class="auth-info-row">
                            <p [ngClass]="{'valid': isLengthValid()}">10 characters</p>
                            <p [ngClass]="{'valid': isUppercaseValid()}">an uppercase letter</p>
                            <p [ngClass]="{'valid': isSpecialCharValid()}">a special character</p>
                            <p [ngClass]="{'valid': isLowercaseValid()}">a lowercase letter</p>
                            <p [ngClass]="{'valid': isNumberValid()}">a number</p>
                        </div>
                    </div>

                </div>
            </div>
            <div class="auth-btn-container">
                <button (click)="onNext()" class="hungr-btn hungr-btn-primary" [disabled]="step1Form.invalid || step1Form.pending">
                    <span *ngIf="step1Form.pending">Checking...</span>
                    <span *ngIf="!step1Form.pending">Next</span>
                </button>
            </div>
            <div class="auth-redirect">
                <a class="auth-redirect-link" routerLink="/sign-in">
                    Already have an account? Log In
                </a>
            </div>
        </form>
    </div>

</div>