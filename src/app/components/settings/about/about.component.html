<div class="container">
  <!-- Restaurant Selection Section - Full Width -->
  <div class="restaurant-selector-container">
    <div class="block restaurantBlock">
      <div class="section-header">
        <h6 class="section-title">
          <i class="material-symbols-outlined">store</i>
          Select Restaurant
        </h6>
        <p class="section-description">Choose which restaurant's about page you want to edit.</p>
      </div>
      <div class="formGroup">
        <label class="field-label">
          <i class="material-symbols-outlined">restaurant</i>
          Restaurant
        </label>
        <select
          class="formControl enhanced-select"
          [(ngModel)]="selectedRestaurantId"
          (change)="onRestaurantChange(selectedRestaurantId)"
          [disabled]="isLoadingRestaurants"
        >
          <option value="" disabled>Select a restaurant...</option>
          <option 
            *ngFor="let restaurant of restaurants" 
            [value]="restaurant.restaurantID"
            [disabled]="!restaurant.status"
          >
            {{ restaurant.restaurantName }} - {{ restaurant.city }}, {{ restaurant.province }}
            {{ !restaurant.status ? ' (Inactive)' : '' }}
          </option>
        </select>
        <div *ngIf="isLoadingRestaurants" class="loading-indicator">
          <i class="material-symbols-outlined rotating">refresh</i>
          Loading restaurants...
        </div>
      </div>
    </div>
  </div>

  <!-- About Page Settings (only show when restaurant is selected) -->
  <div class="settings-container" *ngIf="selectedRestaurantId">
    <div class="outerCol">
    <!-- About Text Section -->
    <div class="block aboutBlock">
      <div class="section-header">
        <h6 class="section-title">
          <i class="material-symbols-outlined">restaurant</i>
          About Us
        </h6>
        <p class="section-description">Tell your customers about your restaurant, story, and what makes you special.</p>
      </div>
      <div class="formGroup">
        <textarea
          matInput
          [(ngModel)]="aboutText"
          placeholder="Share your restaurant's story, mission, and what makes your dining experience unique..."
          (input)="markAsChanged()"
          class="enhanced-textarea"
        ></textarea>
      </div>
    </div>

    <!-- Images Section -->
    <div class="block imgBlock">
      <div class="section-header">
        <h6 class="section-title">
          <i class="material-symbols-outlined">photo_library</i>
          Restaurant Images
        </h6>
        <p class="section-description">Upload high-quality images to showcase your restaurant and atmosphere.</p>
      </div>
      
      <!-- Main Image -->
      <section class="image-section">
        <div class="image-header">
          <div class="image-info">
            <h6 class="image-title">Hero Image</h6>
            <p class="image-description">This will be the main image displayed prominently on your about page.</p>
          </div>
          <div class="image-preview" *ngIf="mainImageUrl">
            <img [src]="mainImageUrl" alt="Main restaurant image" class="preview-thumbnail" />
          </div>
        </div>
        <div class="image-actions">
          <button 
            class="btn-upload" 
            type="button"
            (click)="openMainImageUpload()"
            [disabled]="isSaving">
            <i class="material-symbols-outlined">{{ isSaving ? 'hourglass_empty' : 'upload' }}</i>
            <span>{{ mainImageUrl ? 'Change Image' : 'Upload Hero Image' }}</span>
          </button>
          <button
            *ngIf="mainImageUrl"
            class="btn-remove"
            type="button"
            (click)="removeMainImg()"
            title="Remove image">
            <i class="material-symbols-outlined">delete</i>
          </button>
        </div>
      </section>

      <!-- Additional Images -->
      <section class="image-section">
        <div class="image-header">
          <div class="image-info">
            <h6 class="image-title">Additional Images</h6>
            <p class="image-description">Add more images to showcase your restaurant's atmosphere, food, or team.</p>
          </div>
        </div>
        
        <!-- Display existing additional images -->
        <div class="additional-images-grid" *ngIf="additionalImageUrls.length > 0">
          <div class="additional-image-item" *ngFor="let imageUrl of additionalImageUrls; let i = index">
            <div class="image-preview">
              <img [src]="imageUrl" [alt]="'Additional restaurant image ' + (i + 1)" class="preview-thumbnail" />
            </div>
            <div class="image-actions">
              <button
                class="btn-remove"
                type="button"
                (click)="removeAdditionalImg(i)"
                title="Remove image">
                <i class="material-symbols-outlined">delete</i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="image-actions">
          <button 
            class="btn-upload" 
            type="button"
            (click)="openAdditionalImageUpload()"
            [disabled]="isSaving">
            <i class="material-symbols-outlined">{{ isSaving ? 'hourglass_empty' : 'upload' }}</i>
            <span>{{ additionalImageUrls.length > 0 ? 'Add More Images' : 'Upload Additional Images' }}</span>
          </button>
          <button
            *ngIf="additionalImageUrls.length > 0"
            class="btn-remove"
            type="button"
            (click)="removeAllAdditionalImgs()"
            title="Remove all additional images">
            <i class="material-symbols-outlined">delete_sweep</i>
            Remove All
          </button>
        </div>
        
        <!-- Image count info -->
        <div class="image-count-info" *ngIf="additionalImageUrls.length > 0">
          <p class="image-count-text">
            <i class="material-symbols-outlined">photo_library</i>
            {{ additionalImageUrls.length }} additional image{{ additionalImageUrls.length !== 1 ? 's' : '' }} uploaded
          </p>
        </div>
      </section>
    </div>

    <!-- Business Hours Section -->
    <div class="block hoursBlock">
      <div class="section-header">
        <div class="section-title-row">
          <h6 class="section-title">
            <i class="material-symbols-outlined">schedule</i>
            Business Hours
          </h6>
          <div class="visibility-toggle">
            <mat-slide-toggle
              [(ngModel)]="isBusinessHoursVisible"
              color="primary"
              (change)="markAsChanged()">
            </mat-slide-toggle>
            <label class="toggle-label" [class.active]="isBusinessHoursVisible">
              {{ isBusinessHoursVisible ? 'Visible on menu' : 'Hidden from menu' }}
            </label>
          </div>
        </div>
        <p class="section-description">Set your restaurant's operating hours and let customers know when you're open.</p>
      </div>
      <div class="formGroup">
        <textarea 
          matInput 
          [(ngModel)]="businessHours" 
          (input)="markAsChanged()"
          placeholder="Example: Monday - Friday: 11:00 AM - 10:00 PM&#10;Saturday - Sunday: 12:00 PM - 11:00 PM"
          class="enhanced-textarea hours-textarea">
        </textarea>
      </div>
    </div>

    <!-- Contact Details Section -->
    <div class="block contactBlock">
      <div class="section-header">
        <div class="section-title-row">
          <h6 class="section-title">
            <i class="material-symbols-outlined">contact_phone</i>
            Contact Details
          </h6>
          <div class="visibility-toggle">
            <mat-slide-toggle
              [(ngModel)]="isContactDetailsVisible"
              color="primary"
              (change)="markAsChanged()">
            </mat-slide-toggle>
            <label class="toggle-label" [class.active]="isContactDetailsVisible">
              {{ isContactDetailsVisible ? 'Visible on menu' : 'Hidden from menu' }}
            </label>
          </div>
        </div>
        <p class="section-description">Provide contact information so customers can reach you for reservations or questions.</p>
      </div>
      <div class="contact-fields">
        <div class="formGroup">
          <label class="field-label">
            <i class="material-symbols-outlined">email</i>
            Email Address
          </label>
          <input
            type="email"
            class="formControl enhanced-input"
            placeholder="restaurant@example.com"
            [(ngModel)]="email"
            (input)="markAsChanged()"
          />
        </div>
        <div class="formGroup">
          <label class="field-label">
            <i class="material-symbols-outlined">phone</i>
            Phone Number
          </label>
          <input
            type="tel"
            class="formControl enhanced-input"
            placeholder="+27 (0)12 345 6789"
            [(ngModel)]="cellphone"
            (input)="markAsChanged()"
          />
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Right Column - Preview and Actions -->
  <div class="outerColSmall" *ngIf="selectedRestaurantId">
    <!-- Save Actions -->
    <div class="block btnBlock">
      <div class="save-header">
        <h6 class="save-title">
          <i class="material-symbols-outlined">save</i>
          Save Changes
        </h6>
        <p class="save-description">Review your changes and save them to update your about page.</p>
      </div>
      <div class="save-actions">
        <button class="btn-discard" (click)="discardChanges()" [disabled]="!hasUnsavedChanges">
          <i class="material-symbols-outlined">undo</i>
          Discard Changes
        </button>
        <button class="btn-save" (click)="update()" [disabled]="!hasUnsavedChanges || isSaving">
          <i class="material-symbols-outlined">{{ isSaving ? 'hourglass_empty' : 'save' }}</i>
          {{ isSaving ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </div>

    <!-- Preview Section -->
    <div class="block previewBlock">
      <div class="preview-header">
        <h6 class="preview-title">
          <i class="material-symbols-outlined">visibility</i>
          Live Preview
        </h6>
        <p class="preview-description">See how your about page will appear to customers in real-time.</p>
      </div>
      
      <!-- Menu Selection for Preview -->
      <div class="formGroup" *ngIf="menus.length > 0">
        <label class="field-label">
          <i class="material-symbols-outlined">restaurant_menu</i>
          Select Menu to Preview
        </label>
        <select
          class="formControl enhanced-select"
          [(ngModel)]="selectedMenuId"
          (change)="onMenuSelectionChange($event)"
          [disabled]="isLoadingMenus"
        >
          <option value="" disabled>Select a menu...</option>
          <option *ngFor="let menu of menus" [value]="menu.menuID || menu.menuId || menu.id || menu._id">
            {{ menu.menuName || menu.name || 'Unnamed Menu' }}
          </option>
        </select>
        <div *ngIf="isLoadingMenus" class="loading-indicator">
          <i class="material-symbols-outlined rotating">refresh</i>
          Loading menus...
        </div>
      </div>

      <!-- Iframe Preview -->
      <div class="preview-content" *ngIf="selectedMenuId">
        <div class="preview-controls">
          <button 
            class="btn-refresh" 
            type="button"
            (click)="refreshPreview()"
            title="Refresh preview">
            <i class="material-symbols-outlined">refresh</i>
            Refresh Preview
          </button>
        </div>
        <div class="phonePreviewContainer">
          <iframe
            #previewIframe
            [src]="getPreviewUrl()"
            frameborder="0"
            class="previewIframe"
            title="About Page Preview"
          ></iframe>
        </div>
      </div>

      <!-- No Menu Available Message -->
      <div class="preview-content" *ngIf="menus.length === 0 && selectedRestaurantId">
        <div class="no-menu-message">
          <i class="material-symbols-outlined">restaurant_menu</i>
          <p>No active menus available for this restaurant.</p>
          <p class="message-hint">Please create and activate a menu first to see the preview.</p>
        </div>
      </div>

      <!-- No Restaurant Selected Message -->
      <div class="preview-content" *ngIf="!selectedRestaurantId">
        <div class="no-restaurant-message">
          <i class="material-symbols-outlined">store</i>
          <p>Please select a restaurant to see the preview.</p>
        </div>
      </div>
    </div>
  </div>





<app-loading [isLoading]="isSaving"></app-loading>
