<div class="container">
  <!-- Restaurant Selection Section - Full Width -->
  <div class="restaurant-selector-container">
    <app-content-block title="Select Restaurant" customClass="restaurantBlock">
      <p class="section-description">Choose which restaurant's about page you want to edit.</p>
      <div class="formGroup">
        <app-form-select label="Restaurant" placeholder="Select a restaurant..." [options]="restaurantOptions"
          [(ngModel)]="selectedRestaurantId" (selectionChange)="onRestaurantChange($event.value)"
          [disabled]="isLoadingRestaurants">
        </app-form-select>
        <div *ngIf="isLoadingRestaurants" class="loading-indicator">
          <i class="material-symbols-outlined rotating">refresh</i>
          Loading restaurants...
        </div>
      </div>
    </app-content-block>
  </div>

  <!-- About Page Settings (only show when restaurant is selected) -->
  <div class="settings-container" *ngIf="selectedRestaurantId">
    <div class="outerCol">
      <!-- About Text Section -->
      <app-content-block title="About Us" customClass="aboutBlock">
        <p class="section-description">Tell your customers about your restaurant, story, and what makes you special.</p>
        <div class="formGroup">
          <app-form-textarea label="About Us Text"
            placeholder="Share your restaurant's story, mission, and what makes your dining experience unique..."
            [(ngModel)]="aboutText" (ngModelChange)="markAsChanged()" [rows]="8">
          </app-form-textarea>
        </div>
      </app-content-block>

      <!-- Images Section -->
      <app-content-block title="Restaurant Images" customClass="imgBlock">
        <p class="section-description">Upload high-quality images to showcase your restaurant and atmosphere.</p>

        <!-- Main Image -->
        <section class="image-section">
          <div class="image-header">
            <div class="image-info">
              <h6 class="image-title">Hero Image</h6>
              <p class="image-description">This will be the main image displayed prominently on your about page.</p>
            </div>
            <div class="image-preview" *ngIf="mainImageUrl">
              <img [src]="mainImageUrl" alt="Main restaurant image" class="preview-thumbnail" />
            </div>
          </div>
          <div class="image-actions">
            <button class="btnPrimary btn-sm" type="button" (click)="openMainImageUpload()" [disabled]="isSaving">
              <i class="material-symbols-outlined">{{ isSaving ? 'hourglass_empty' : 'upload' }}</i>
              <span>{{ mainImageUrl ? 'Change Image' : 'Upload Hero Image' }}</span>
            </button>
            <button *ngIf="mainImageUrl" class="btn-remove" type="button" (click)="removeMainImg()"
              title="Remove image">
              <i class="material-symbols-outlined">delete</i>
            </button>
          </div>
        </section>

        <!-- Additional Images -->
        <section class="image-section">
          <div class="image-header">
            <div class="image-info">
              <h6 class="image-title">Additional Images</h6>
              <p class="image-description">Add more images to showcase your restaurant's atmosphere, food, or team.</p>
            </div>
          </div>

          <!-- Display existing additional images -->
          <div class="additional-images-grid" *ngIf="additionalImageUrls.length > 0">
            <div class="additional-image-item" *ngFor="let imageUrl of additionalImageUrls; let i = index">
              <div class="image-preview">
                <img [src]="imageUrl" [alt]="'Additional restaurant image ' + (i + 1)" class="preview-thumbnail" />
              </div>
              <div class="image-actions">
                <button class="btn-remove" type="button" (click)="removeAdditionalImg(i)" title="Remove image">
                  <i class="material-symbols-outlined">delete</i>
                </button>
              </div>
            </div>
          </div>

          <div class="image-actions">
            <button class="btnPrimary btn-sm" type="button" (click)="openAdditionalImageUpload()" [disabled]="isSaving">
              <i class="material-symbols-outlined">{{ isSaving ? 'hourglass_empty' : 'upload' }}</i>
              <span>{{ additionalImageUrls.length > 0 ? 'Add More Images' : 'Upload Additional Images' }}</span>
            </button>
            <button *ngIf="additionalImageUrls.length > 0" class="btn-remove" type="button"
              (click)="removeAllAdditionalImgs()" title="Remove all additional images">
              <i class="material-symbols-outlined">delete_sweep</i>
              Remove All
            </button>
          </div>

          <!-- Image count info -->
          <div class="image-count-info" *ngIf="additionalImageUrls.length > 0">
            <p class="image-count-text">
              <i class="material-symbols-outlined">photo_library</i>
              {{ additionalImageUrls.length }} additional image{{ additionalImageUrls.length !== 1 ? 's' : '' }}
              uploaded
            </p>
          </div>
        </section>
      </app-content-block>

      <!-- Business Hours Section -->
      <app-content-block title="Business Hours" customClass="hoursBlock">
        <div class="section-header">
          <div class="section-title-row">
            <div class="visibility-toggle">
              <mat-slide-toggle [(ngModel)]="isBusinessHoursVisible" color="primary" (change)="markAsChanged()">
              </mat-slide-toggle>
              <label class="toggle-label" [class.active]="isBusinessHoursVisible">
                {{ isBusinessHoursVisible ? 'Visible on menu' : 'Hidden from menu' }}
              </label>
            </div>
          </div>
          <p class="section-description">Set your restaurant's operating hours and let customers know when you're open.
          </p>
        </div>
        <div class="formGroup">
          <app-form-textarea label="Business Hours"
            placeholder="Example: Monday - Friday: 11:00 AM - 10:00 PM&#10;Saturday - Sunday: 12:00 PM - 11:00 PM"
            [(ngModel)]="businessHours" (ngModelChange)="markAsChanged()" [rows]="6">
          </app-form-textarea>
        </div>
      </app-content-block>

      <!-- Contact Details Section -->
      <app-content-block title="Contact Details" customClass="contactBlock">
        <div class="section-header">
          <div class="section-title-row">
            <div class="visibility-toggle">
              <mat-slide-toggle [(ngModel)]="isContactDetailsVisible" color="primary" (change)="markAsChanged()">
              </mat-slide-toggle>
              <label class="toggle-label" [class.active]="isContactDetailsVisible">
                {{ isContactDetailsVisible ? 'Visible on menu' : 'Hidden from menu' }}
              </label>
            </div>
          </div>
          <p class="section-description">Provide contact information so customers can reach you for reservations or
            questions.</p>
        </div>
        <div class="contact-fields">
          <div class="formGroup">
            <app-form-input type="email" label="Email Address" placeholder="restaurant@example.com" [(ngModel)]="email"
              (ngModelChange)="markAsChanged()">
            </app-form-input>
          </div>
          <div class="formGroup">
            <app-form-input type="tel" label="Phone Number" placeholder="+27 (0)12 345 6789" [(ngModel)]="cellphone"
              (ngModelChange)="markAsChanged()">
            </app-form-input>
          </div>
        </div>
      </app-content-block>
    </div>
  </div>

  <!-- Right Column - Preview and Actions -->
  <div class="outerColSmall" *ngIf="selectedRestaurantId">
    <!-- Save Actions -->
    <app-content-block title="Save Changes" customClass="btnBlock">
      <p class="save-description">Review your changes and save them to update your about page.</p>
      <div class="save-actions">
        <button class="hungr-btn hungr-btn-secondary" (click)="discardChanges()" [disabled]="!hasUnsavedChanges">
          <i class="material-symbols-outlined">undo</i>
          Discard Changes
        </button>
        <button class="hungr-btn hungr-btn-primary" (click)="update()" [disabled]="!hasUnsavedChanges || isSaving">
          <i class="material-symbols-outlined">{{ isSaving ? 'hourglass_empty' : 'save' }}</i>
          {{ isSaving ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </app-content-block>

    <!-- Preview Section -->
    <app-content-block title="Live Preview" class="previewBlock">
      <p class="preview-description">See how your about page will appear to customers in real-time.</p>

      <!-- Menu Selection for Preview -->
      <div class="formGroup" *ngIf="menus.length > 0">
        <app-form-select label="Select Menu to Preview" placeholder="Select a menu..." [options]="menuOptions"
          [(ngModel)]="selectedMenuId" (selectionChange)="onMenuSelectionChange($event)" [disabled]="isLoadingMenus">
        </app-form-select>
        <div *ngIf="isLoadingMenus" class="loading-indicator">
          <i class="material-symbols-outlined rotating">refresh</i>
          Loading menus...
        </div>
      </div>

      <!-- Iframe Preview -->
      <div class="preview-content" *ngIf="menus.length > 0 && selectedRestaurantId">
        <div class="phonePreviewContainer">
          <iframe #previewIframe [src]="getPreviewUrl()" frameborder="0" class="previewIframe"
            title="About Page Preview"></iframe>
        </div>
      </div>

      <!-- No Menu Available Message -->
      <div class="preview-content" *ngIf="menus.length === 0 && selectedRestaurantId && !isLoadingMenus">
        <div class="no-menu-message">
          <i class="material-symbols-outlined">restaurant_menu</i>
          <p>No active menus available for this restaurant.</p>
          <p class="message-hint">Please create and activate a menu first to see the preview.</p>
        </div>
      </div>

      <!-- No Restaurant Selected Message -->
      <div class="preview-content" *ngIf="!selectedRestaurantId">
        <div class="no-restaurant-message">
          <i class="material-symbols-outlined">store</i>
          <p>Please select a restaurant to see the preview.</p>
        </div>
      </div>
    </app-content-block>
  </div>





  <app-loading [isLoading]="isSaving"></app-loading>