<div class="settingspage inner-page">
  <app-content-block title="Profile">
    <form
      [formGroup]="accountForm"
      (ngSubmit)="saveAccountDetails()"
      class="formBlock"
    >
      <div class="leftCol">

        <div class="row">
          <div class="formGroup">
            <app-form-input
              label="First name"
              type="text"
              placeholder="John"
              [required]="true"
              [errorMessage]="getFieldError('name')"
              formControlName="name">
            </app-form-input>
          </div>
          <div class="formGroup">
            <app-form-input
              label="Surname"
              type="text"
              placeholder="Smith"
              [required]="true"
              [errorMessage]="getFieldError('surname')"
              formControlName="surname">
            </app-form-input>
          </div>
        </div>

        <div class="row">
          <div class="formGroup">
            <app-form-input
              label="Password"
              type="password"
              placeholder="Enter new password"
              [required]="true"
              [errorMessage]="getFieldError('password')"
              formControlName="password">
            </app-form-input>
          </div>
        </div>
      </div>
      <div class="rightCol">
        <div class="row">
          <h6>Contact Details</h6>
        </div>
        <div class="row">
          <div class="formGroup">
            <app-form-input
              label="Phone number"
              type="tel"
              placeholder="+278212345678"
              [required]="true"
              [errorMessage]="getFieldError('phone')"
              formControlName="phone">
            </app-form-input>
          </div>
        </div>
      </div>
    </form>
    <div class="row btnRow">
      <button class="hungr-btn hungr-btn-tertiary" (click)="authService.SignOut()">log out</button>
      <button class="hungr-btn hungr-btn-secondary" (click)="saveAll()">Save Changes</button>
    </div>
  </app-content-block>

  <app-content-block title="HUNGR Plan">
    <div class="row">
      <div class="rowInner">
        <div class="subscription-status" *ngIf="subscriptionData">
          <span class="status-badge" [ngClass]="{
            'active': subscriptionData.status === 'active',
            'paused': subscriptionData.status === 'paused',
            'cancelled': subscriptionData.status === 'cancelled'
          }">
            {{ subscriptionData.status | titlecase }}
          </span>
          <p>Digital Menu Subscription - R{{ (subscriptionData.amount || subscriptionData.recurringAmount || 99900) / 100 }}/month</p>
          <p *ngIf="subscriptionData.nextBillingDate">
            Next billing: {{ subscriptionData.nextBillingDate | date }}
          </p>
          <p *ngIf="subscriptionData.pausedAt">
            Paused since: {{ subscriptionData.pausedAt | date }}
          </p>
          <p *ngIf="subscriptionData.cancelledAt">
            Cancelled on: {{ subscriptionData.cancelledAt | date }}
          </p>
        </div>
        <p *ngIf="!subscriptionData">
          No active subscription
        </p>
        <div class="row btnRow">
          <button
            class="hungr-btn hungr-btn-tertiary"
            (click)="pauseSubscription()"
            *ngIf="subscriptionData && subscriptionData.status === 'active'"
            [disabled]="isPausing || isCancellingSubscription || isResuming || isChangingSubscription"
          >
            {{ isPausing ? 'Pausing...' : 'Pause Subscription' }}
          </button>
          <button
            class="hungr-btn hungr-btn-secondary"
            (click)="resumeSubscription()"
            *ngIf="subscriptionData && subscriptionData.status === 'paused'"
            [disabled]="isResuming || isCancellingSubscription || isPausing || isChangingSubscription"
          >
            {{ isResuming ? 'Resuming...' : 'Resume Subscription' }}
          </button>
          <button
            class="hungr-btn hungr-btn-tertiary"
            (click)="cancelSubscription()"
            *ngIf="subscriptionData && (subscriptionData.status === 'active' || subscriptionData.status === 'paused')"
            [disabled]="isCancellingSubscription || isPausing || isResuming || isChangingSubscription"
          >
            {{ isCancellingSubscription ? 'Cancelling...' : 'Cancel Subscription' }}
          </button>
          <button
            class="hungr-btn hungr-btn-secondary"
            (click)="changeSubscription()"
            *ngIf="subscriptionData && subscriptionData.status === 'active'"
            [disabled]="isChangingSubscription || isPausing || isCancellingSubscription || isResuming"
          >
            {{ isChangingSubscription ? 'Changing...' : 'Change Subscription' }}
          </button>
        </div>
      </div>
    </div>
  </app-content-block>
  <app-content-block title="Billing">
    <div class="row">
      <div class="formGroup" style="flex: 3">
        <app-form-input
          label="Card Holder Name"
          type="text"
          placeholder="JS Smith"
          [required]="true"
          [errorMessage]="getFieldError('cardHolderName')">
        </app-form-input>
      </div>
      <div class="formGroup" style="flex: 3">
        <app-form-input
          label="Card number"
          type="text"
          placeholder="xxxx xxxx 1234"
          [required]="true"
          [errorMessage]="getFieldError('cardNumber')">
        </app-form-input>
      </div>
      <div class="formGroup" style="flex: 1">
        <app-form-input
          label="CVV"
          type="text"
          placeholder="xxx"
          [required]="true"
          [errorMessage]="getFieldError('cvv')">
        </app-form-input>
      </div>
      <div class="formGroup" style="flex: 1">
        <app-form-input
          label="Expiry Date"
          type="text"
          placeholder="mm/yy"
          [required]="true"
          [errorMessage]="getFieldError('expiryDate')">
        </app-form-input>
      </div>
    </div>

    <div class="row btnHolder">
      <button class="hungr-btn hungr-btn-secondary">Save changes</button>
    </div>
  </app-content-block>
  <app-content-block title="Notifications" *ngIf="currentUserData">
    <div class="toggleHolder">
      <div class="toggle-container">
        <label>Email Notifications</label>
        <mat-slide-toggle
          [(ngModel)]="currentUserData!.marketingConsent"
          color="#16D3D2"
        ></mat-slide-toggle>
      </div>

      <div class="toggle-container">
        <label>Tips & Tutorials</label>
        <mat-slide-toggle
          [(ngModel)]="currentUserData!.tipsTutorials"
          color="#16D3D2"
        ></mat-slide-toggle>
      </div>

      <div class="toggle-container">
        <label>User Insights</label>
        <mat-slide-toggle
          [(ngModel)]="currentUserData!.userInsights"
          color="#16D3D2"
        ></mat-slide-toggle>
      </div>
    </div>
  </app-content-block>

  <!--  <app-content-block title="POS Integration" customClass="posBlock">
    <h6>POS Integration</h6>
    <div class="row">
      <p>
        This is the POS system that is currently linked to your HUNGR account..
      </p>
      <div class="formGroup">
        <div class="label-container">
          <div class="error-message">POS System name</div>
        </div>
        <div class="input-holder">
          <mat-select placeholder="POS System name">
            <mat-optgroup>
              <mat-option value="gaap">GAAP</mat-option>
              <mat-option value="oracle">Oracle Micros</mat-option>
              <mat-option value="pilot">Pilot</mat-option>
            </mat-optgroup>
          </mat-select>
        </div>
      </div>
    </div>
  </div> -->
</div>

<app-loading [isLoading]="isSaving"></app-loading>
